<!DOCTYPE html>
<html>
  <head>
    <title>
      RVM: Ruby Version Manager -
      Phusion Passenger 3
    </title>
    <link href='/css/screen.css' media='screen' rel='stylesheet' type='text/css'>
    <link href='https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css' rel='stylesheet' type='text/css'>
    <link href='/css/algolia-docsearch.css' rel='stylesheet' type='text/css'>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <meta content='w2V78a6cwiHD5Gm8yvlTP21xZ1YgVguDdC0JGDEA2d0' name='google-site-verification'>
    
  </head>
  <body>
    <div id='heaven'></div>
    <div id='container'>
      <div id='logo'>
        <a href='/'>
          <img alt='RVM Logo' src='/images/logo.png'>
        </a>
      </div>
      <div id='support'>
        <div class='title'>Support</div>
        <div class='text'>
          RVM is maintained by community of volunteers, report issues to
          <a href='https://github.com/rvm/rvm/issues'>
            RVM issues tracker.
          </a>
          <div class='more'>
            If you can help or wish to become one of the maintainers - just start helping.
            You can find more RVM related projects at
            <a href='https://github.com/rvm'>
              RVM GitHub organization.
            </a>
          </div>
        </div>
      </div>
      <div id='donate'>
        <div class='title'>Donation</div>
        <div class='text'>
          Love RVM? Help us maintain RVM, a donation can help with it.
          Want to help in other way, want to be a sponsor?
          <div class='more'>
            contact:
            <a href='mailto:mpapis@gmail.com'>
              Michal Papis
            </a>
          </div>
        </div>
      </div>
      <div id='sponsors'>
        <div class='title'>Sponsors</div>
        <div class='logo long'>
          <a href='https://www.fastly.com/'>
            <img alt='Fastly' height='50' src='/images/fastly_logo-01.png'>
          </a>
        </div>
      </div>
      <div id='carbon_ads_box'>
        <div class='title'>Carbon Ads</div>
        <script async='async' id='_carbonads_js' src='https://cdn.carbonads.com/carbon.js?zoneid=1673&amp;serve=C6AILKT&amp;placement=rvmio' type='text/javascript'></script>
      </div>
      <div class='clear'></div>
      <div id='content'>
        <a id='top'></a>
        <div class='breadcrumbs'><a href="/">Documentation</a>&nbsp;&gt;&nbsp;<a href="/integration/">Integration</a>&nbsp;&gt;&nbsp;<a href="/integration/passenger3/">Passenger 3</a><hr /></div>
        <a name='passenger'></a>
        <h1>
          Using RVM rubies with Passenger 3
        </h1>
        <p>
          This page contains instructions for using RVM with Phusion Passenger 3. You really should upgrade to Phusion Passenger 4 or later because it comes with much better RVM support. See
          <a href='/integration/passenger/'>this page</a>
          for Phusion Passenger 4 instructions.
        </p>
        <h1>
          Passenger 3
        </h1>
        <p>
          Passenger is essentially 'mod_ruby' for both Nginx and Apache.
          You may select *exactly one* Ruby to run all of your Passenger 3 applications.
          If you need to run more than one Ruby interpreter then you should choose the most common one.
          You then use proxy pass to external application servers such as Passenger Standalone, Unicorn, Thin, Mongrel, Mongrel2, etc... in order to accomplish running different applications under different rubies.
          For a full explanation of this (with pretty pictures!) see the
          <a href='http://blog.phusion.nl/2010/09/21/phusion-passenger-running-multiple-ruby-versions/'>
            post on Phusion's Blog
          </a>
        </p>
        <h2>
          Installing Nginx/Apache with Passenger
        </h2>
        <p>
          First of all there's passenger-install-apache2-module and passenger-install-nginx-module. At the end of the installation it outputs a PassengerRuby configuration snippet for the web server. Its value is set to the RVM Ruby wrapper script that corresponds with the RVM Ruby and RVM gemset that was used to run the installer. This should be all you need for configuration of Passenger 3!
        </p>
        <p>
          If you're still running into trouble instead of creating a .rvmrc file use one of the new formats like .ruby-version or .versions.conf:
        </p>
        <pre class='code'>echo 1.9.3@my-app-name > .ruby-version&#x000A;</pre>
        <p>
          Then in the rails project, add a new file config/setup_load_paths.rb and add
          Starting with RVM 1.12.0(or head) RVM is installed as a gem in default gemset,
          there is no need to unshift $LOAD_PATH, but it's required to set GEM_PATH.
          <a href='#old_setup_load_paths'>config/setup_load_paths.rb.</a>
        </p>
        <pre class='code'>if ENV['MY_RUBY_HOME'] && ENV['MY_RUBY_HOME'].include?('rvm')&#x000A;  begin&#x000A;    gems_path = ENV['MY_RUBY_HOME'].split(/@/)[0].sub(/rubies/,'gems')&#x000A;    ENV['GEM_PATH'] = "#{gems_path}:#{gems_path}@global"&#x000A;    require 'rvm'&#x000A;    RVM.use_from_path! File.dirname(File.dirname(__FILE__))&#x000A;  rescue LoadError&#x000A;    raise "RVM gem is currently unavailable."&#x000A;  end&#x000A;end&#x000A;&#x000A;# If you're not using Bundler at all, remove lines bellow&#x000A;ENV['BUNDLE_GEMFILE'] = File.expand_path('../Gemfile', File.dirname(__FILE__))&#x000A;require 'bundler/setup'&#x000A;</pre>
        <p>
          Please note that for Passenger 3 you now use the ruby wrapper script directly with no need to use the passenger_ruby wrapper.
        </p>
        <h2>
          Starting Passenger Standalone
        </h2>
        <p>
          Then there's Passenger Standalone, i.e. 'passenger start'. Passenger Standalone uses Nginx internally, and it writes a passenger_ruby directive to the Nginx configuration file. This directive points to the RVM Ruby wrapper script that corresponds with the RVM Ruby and RVM gemset that was used to run the 'passenger start' command.
        </p>
        <h2>
          Bundler Gotcha
        </h2>
        <p>
          When using Bundler in your project, Passenger will try to be smart and only add to your $LOAD_PATH the gems listed in your Gemfile. This can lead to "unable to load" errors for your unlisted gems (this should only happen during development). You can check your run-time load path by adding
        </p>
        <pre class='code'>f = File.open('/tmp/load_path', 'w')&#x000A;f.write($:)&#x000A;f.close&#x000A;</pre>
        <p>
          to your app's main file (before the "require" calls). You won't be able to load any gems that are not in that load path.
        </p>
        <h2>
          Troubleshooting
        </h2>
        <ul>
          <li>
            The most common issue is forgetting the /bin/ part of the path to get the proper wrapper script:
          </li>
          <li>
            The next most common issue is listening to the output of the passenger installation script with
            respect to where the passenger_ruby/PassengerRuby is located. Be sure to use the wrapper script location
            as specified above. To be more clear, see the nginx example below:
            <pre class='code'>passenger_ruby /home/wayne/.rvm/bin/passenger_ruby;&#x000A;* NOTICE THE '.rvm/bin' DIR  ^ ^ ^&#x000A;* do NOT use the actual ruby binary in .rvm/rubies/{passenger_ruby}/bin/ruby&#x000A;* do not listen to passenger's output for passenger_ruby as passenger is not aware of rvm.&#x000A;</pre>
            For system wide (root) installs the bin directory is /usr/local/rvm/bin instead:
            <pre class='code'>passenger_ruby /usr/local/rvm/bin/passenger_ruby;&#x000A;</pre>
          </li>
        </ul>
        <h2>
          FAQ
        </h2>
        <ul>
          <li>
            <p>
              <strong>Q: Can I run multiple projects under passenger with each project on a different ruby version?</strong>
            </p>
            <p>
              A: Passenger 3 only supports running under *one* Ruby, but you can get per-site/project behavior
              using a proxy pass.
            </p>
          </li>
          <li>
            <p>
              <strong>Q: How do I use custom gemsets under passenger?</strong>
            </p>
            <p>
              A: Without bundler you can either set environment variables yourself in your config.ru like:
            </p>
            <pre class='code'>ENV["GEM_HOME"]=%x{"source ~/.bash_profile ; rvm ree@pancake ; rvm gemdir"}.strip</pre>
            <p>
              A: With bundler: Install bundler outside any gemset, switch back to the gemset you wish to use and run
              <tt>bundle install</tt>
              and restart the application (by touching tmp/restart.txt). This works becase bundler stores absolute paths inside
              <tt>.bundle/environment.rb</tt>
              which will be loaded by bundler directly.
              If this doesn't work as expected, try running bundle install like so:
            </p>
            <pre class='code'>bundle install $BUNDLE_PATH</pre>
            <p>
              How can I use commands like passenger-status in conjunction with a user install but run them as root?
              Mainly the key to this is to use wildcards in the sudoers file as the following examples show.
              <pre class='code'>/usr/bin/env GEM_PATH=* GEM_HOME=* PATH=* passenger-status&#x000A;</pre>
            </p>
          </li>
        </ul>
        <p id='old_setup_load_paths'>
          This is config/setup_load_paths.rb for RVM versions bellow 1.12.0.
        </p>
        <pre class='code'>if ENV['MY_RUBY_HOME'] && ENV['MY_RUBY_HOME'].include?('rvm')&#x000A;  begin&#x000A;    rvm_path     = File.dirname(File.dirname(ENV['MY_RUBY_HOME']))&#x000A;    rvm_lib_path = File.join(rvm_path, 'lib')&#x000A;    # $LOAD_PATH.unshift rvm_lib_path&#x000A;    require 'rvm'&#x000A;    RVM.use_from_path! File.dirname(File.dirname(__FILE__))&#x000A;  rescue LoadError&#x000A;    # RVM is unavailable at this point.&#x000A;    raise "RVM ruby lib is currently unavailable."&#x000A;  end&#x000A;end&#x000A;&#x000A;# Pick the lines for your version of Bundler&#x000A;# If you're not using Bundler at all, remove all of them&#x000A;&#x000A;# Require Bundler 1.0&#x000A;ENV['BUNDLE_GEMFILE'] = File.expand_path('../Gemfile', File.dirname(__FILE__))&#x000A;require 'bundler/setup'&#x000A;&#x000A;# Require Bundler 0/9&#x000A;# if File.exist?(".bundle/environment.rb")&#x000A;#   require '.bundle/environment'&#x000A;# else&#x000A;#   require 'rubygems'&#x000A;#   require 'bundler'&#x000A;#   Bundler.setup&#x000A;# end&#x000A;</pre>
        <h2>
          Community Resources
        </h2>
        <ul>
          <li>
            <a href='http://old.blog.phusion.nl/2010/09/21/phusion-passenger-running-multiple-ruby-versions/'>
              Phusion blog post on Passenger 3
            </a>
          </li>
        </ul>
        <a id='bottom'></a>
      </div>
      <div id='docindex'>
        <div class='headline'>
          <a style="color: red;" href="/">RVM Documentation Index</a>
          |
          <a href="/blog/">RVM Blog</a>
        </div>
        <div class='headline'>
          <label for="docsearch-input">Search:</label>
          <input id="docsearch-input" type="text" />
        </div>
        <div class='column'>
          <a href="/rvm/">RVM</a>
          <ul><li><a href="/rvm/about/">About</a></li>
          <li><a href="/rvm/autolibs/">Autolibs</a></li>
          <li><a href="/rvm/basics/">Basics</a></li>
          <li><a href="/rvm/best-practices/">Best Practices</a></li>
          <li><a href="/rvm/cli/">Cli</a></li>
          <li><a href="/rvm/configuration/">Configuration</a></li>
          <li><a href="/rvm/info/">Info</a></li>
          <li><a href="/rvm/install/">Install</a></li>
          <li><a href="/rvm/myths/">Myths</a></li>
          <li><a href="/rvm/offline/">Offline</a></li>
          <li><a href="/rvm/prerequisites/">Prerequisites</a></li>
          <li><a href="/rvm/security/">Security</a></li>
          <li><a href="/rvm/upgrading/">Upgrading</a></li></ul>
          <a href='/interpreters/'>Interpreters</a>
          <ul>
            <li>
              <a href='/interpreters/ruby/'>MRI/YARV (ruby)</a>
            </li>
            <li>
              <a href='/interpreters/jruby/'>JRuby (jruby)</a>
            </li>
            <li>
              <a href='/interpreters/rbx/'>Rubinius (rbx)</a>
            </li>
          </ul>
          <a href="/rubies/">Rubies</a>
          <ul><li><a href="/rubies/alias/">Alias</a></li>
          <li><a href="/rubies/default/">Default</a></li>
          <li><a href="/rubies/docs/">Docs</a></li>
          <li><a href="/rubies/info/">Info</a></li>
          <li><a href="/rubies/installing/">Installing</a></li>
          <li><a href="/rubies/list/">List</a></li>
          <li><a href="/rubies/named/">Named</a></li>
          <li><a href="/rubies/patching/">Patching</a></li>
          <li><a href="/rubies/removing/">Removing</a></li>
          <li><a href="/rubies/rubygems/">Rubygems</a></li>
          <li><a href="/rubies/strings/">Strings</a></li>
          <li><a href="/rubies/uninstalling/">Uninstalling</a></li>
          <li><a href="/rubies/upgrading/">Upgrading</a></li></ul>
        </div>
        <div class='column'>
          <a href="/gemsets/">Gemsets</a>
          <ul><li><a href="/gemsets/basics/">Basics</a></li>
          <li><a href="/gemsets/clear/">Clear</a></li>
          <li><a href="/gemsets/copying/">Copying</a></li>
          <li><a href="/gemsets/creating/">Creating</a></li>
          <li><a href="/gemsets/deleting/">Deleting</a></li>
          <li><a href="/gemsets/emptying/">Emptying</a></li>
          <li><a href="/gemsets/exporting/">Exporting</a></li>
          <li><a href="/gemsets/global/">Global</a></li>
          <li><a href="/gemsets/ignoring/">Ignoring</a></li>
          <li><a href="/gemsets/importing/">Importing</a></li>
          <li><a href="/gemsets/initial/">Initial</a></li>
          <li><a href="/gemsets/listing/">Listing</a></li>
          <li><a href="/gemsets/using/">Using</a></li></ul>
          <a href='/set/'>Set Actions</a>
          <ul>
            <li>
              <a href='/set/do/'>do</a>
            </li>
            <li>
              <a href='/set/tests/'>tests</a>
            </li>
            <li>
              <a href='/set/benchmark/'>benchmark</a>
            </li>
          </ul>
          <a href="/workflow/">Workflow</a>
          <ul><li><a href="/workflow/chruby/">Chruby</a></li>
          <li><a href="/workflow/completion/">Completion</a></li>
          <li><a href="/workflow/examples/">Examples</a></li>
          <li><a href="/workflow/hooks/">Hooks</a></li>
          <li><a href="/workflow/irbrc/">Irbrc</a></li>
          <li><a href="/workflow/projects/">Projects</a></li>
          <li><a href="/workflow/prompt/">Prompt</a></li>
          <li><a href="/workflow/proxy/">Proxy</a></li>
          <li><a href="/workflow/rvmrc/">Rvmrc</a></li>
          <li><a href="/workflow/screen/">Screen</a></li>
          <li><a href="/workflow/scripting/">Scripting</a></li>
          <li><a href="/workflow/subshells/">Subshells</a></li></ul>
          <a href="/deployment/">Deployment</a>
          <ul><li><a href="/deployment/best-practices/">Best Practices</a></li>
          <li><a href="/deployment/capistrano/">Capistrano</a></li>
          <li><a href="/deployment/chef/">Chef</a></li>
          <li><a href="/deployment/cron/">Cron</a></li>
          <li><a href="/deployment/god/">God</a></li>
          <li><a href="/deployment/init-d/">Init D</a></li>
          <li><a href="/deployment/passenger/">Passenger</a></li></ul>
        </div>
        <div class='column'>
          <a href="/integration/">Integration</a>
          <ul><li><a href="/integration/bundler/">Bundler</a></li>
          <li><a href="/integration/capistrano/">Capistrano</a></li>
          <li><a href="/integration/chef/">Chef</a></li>
          <li><a href="/integration/cron/">Cron</a></li>
          <li><a href="/integration/culerity/">Culerity</a></li>
          <li><a href="/integration/databases/">Databases</a></li>
          <li><a href="/integration/emacs/">Emacs</a></li>
          <li><a href="/integration/engineyard/">Engineyard</a></li>
          <li><a href="/integration/fish/">Fish</a></li>
          <li><a href="/integration/gnome-terminal/">Gnome Terminal</a></li>
          <li><a href="/integration/god/">God</a></li>
          <li><a href="/integration/heroku/">Heroku</a></li>
          <li><a href="/integration/init-d/">Init D</a></li>
          <li><a href="/integration/jenkins/">Jenkins</a></li>
          <li><a href="/integration/konsole/">Konsole</a></li>
          <li><a href="/integration/lxterminal/">Lxterminal</a></li>
          <li><a href="/integration/macports-before-autolibs/">Macports Before Autolibs</a></li>
          <li><a href="/integration/macports/">Macports</a></li>
          <li><a href="/integration/memprof/">Memprof</a></li>
          <li><a href="/integration/passenger/">Passenger</a></li>
          <li><a href="/integration/pow/">Pow</a></li>
          <li><a href="/integration/qtruby/">Qtruby</a></li>
          <li><a href="/integration/scripting/">Scripting</a></li>
          <li><a href="/integration/simple-terminal/">Simple Terminal</a></li>
          <li><a href="/integration/sketchup/">Sketchup</a></li>
          <li><a href="/integration/sudo/">Sudo</a></li>
          <li><a href="/integration/teamcity/">Teamcity</a></li>
          <li><a href="/integration/textmate/">Textmate</a></li>
          <li><a href="/integration/tk/">Tk</a></li>
          <li><a href="/integration/ubuntu-on-windows/">Ubuntu On Windows</a></li>
          <li><a href="/integration/vagrant/">Vagrant</a></li>
          <li><a href="/integration/vim/">Vim</a></li>
          <li><a href="/integration/xterm/">Xterm</a></li>
          <li><a href="/integration/zsh/">Zsh</a></li></ul>
        </div>
        <div class='column'>
          <a href='/packages/'>Packages</a>
          <a href='/presentations/'>Presentations</a>
          <ul>
            <li>
              <a href='http://www.confreaks.com/videos/3-mwrc2010-managing-ruby-projects-with-rvm'>MWRC 2010</a>
            </li>
            <li>
              <a href='http://confreaks.tv/videos/railsconf2012-rvm-essential-rails-development-tools'>RailsConf 2012</a>
            </li>
            <li>
              <a href='http://confreaks.tv/videos/railsconf2013-developing-rails-apps-in-technical-isolation'>RailsConf 2013</a>
            </li>
            <li>
              <a href='http://thechangelog.com/66/'>Changelog 66 with Wayne</a>
            </li>
            <li>
              <a href='http://www.youtube.com/watch?v=wN-iIC3S1ZM'>RVM 2: Lessons and future</a>
            </li>
            <li>
              <a href='http://www.youtube.com/watch?v=gYNht8H24ZQ'>RVM 2: Python Version Manager</a>
            </li>
            <li>
              <a href='http://thechangelog.com/102/'>Changelog 102 with Michal</a>
            </li>
          </ul>
          <a href='/support/'>Help &amp; Support</a>
          <ul>
            <li>
              <a href='/support/irc/'>Issues tracker</a>
            </li>
            <li>
              <a href='/support/faq/'>FAQ &amp; Notes</a>
            </li>
            <li>
              <a href='/support/troubleshooting/'>Troubleshooting</a>
            </li>
            <li>
              <a href='/support/fixing-broken-ssl-certificates/'>Fixing Broken SSL Certificates</a>
            </li>
          </ul>
          <a href="/qa/">Quality Assurance</a>
          <ul><li><a href="/qa/software_testing/">Software_testing</a></li></ul>
          <a href="/development/">Development</a>
          <ul><li><a href="/development/contributing/">Contributing</a></li>
          <li><a href="/development/debugging/">Debugging</a></li>
          <li><a href="/development/github/">Github</a></li>
          <li><a href="/development/list/">List</a></li></ul>
          <a href='/credits/'>Credits</a>
          <ul>
            <li>
              <a href='/credits/thanks/'>Contributions</a>
            </li>
            <li>
              <a href='/credits/donations/'>Donations</a>
            </li>
            <li>
              <a href='/credits/funding/'>Funding</a>
            </li>
          </ul>
        </div>
        <div class='clear'></div>
      </div>
    </div>
    <div id='footer'>
      <div id='footer-container'>
        &infin;
        Copyright
        &copy; 2009-2011
        <a href='https://github.com/wayneeseguin'>Wayne E. Seguin</a>
        &copy; 2011-2017
        <a href='https://github.com/mpapis'>Michal Papis</a>
        &copy; 2016-2017
        <a href='https://github.com/pkuczynski'>Piotr Kuczynski</a>
        &infin;
        Built with
        <a href='http://nanoc.ws'>Nanoc</a>
        &infin;
        Cached by
        <a href='https://www.fastly.com/'>Fastly</a>
        &infin;
        Tested by
        <a href='http://www.travis-ci.org/'>Travis CI</a>
      </div>
      <script src="https://www.google.com/jsapi" type="text/javascript"></script>
      <script>
        google.load('search', '1', {language : 'en', style : google.loader.themes.SHINY});
        google.setOnLoadCallback(function() {
          var customSearchControl = new google.search.CustomSearchControl('012125088244772422662:eplzzxbbjte');
          customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
          customSearchControl.draw('cse');
        }, true);
      </script>
      <script src="https://www.google.com/jsapi?key=ABQIAAAAlfGITCLCzrcO4cy2viT78RSZcRLSY2B0NYnmYEy-3gaXzTHyQxRduJj7nQ6rEtYNpUjIQpEEosF5XA" type="text/javascript"></script>&#x000A;<script src="/javascripts/site.js" type="text/javascript"></script>
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-24992786-1', 'rvm.io'); // owner unknown :(
        ga('send', 'pageview');
        ga('create', 'UA-45354940-1', 'rvm.io', {'name': 'ga_mpapis'}); // owner mpapis@gmail.com
        ga('ga_mpapis.send', 'pageview');
      </script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
      <script>
        docsearch({
        apiKey: '511953e6f628103639db56a6f0f96977',
        indexName: 'rvm',
        inputSelector: '#docsearch-input',
        debug: false // Set debug to true if you want to inspect the dropdown
        });
      </script>
    </div>
  </body>
</html>
